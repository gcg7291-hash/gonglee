<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>gonglee ì´ìƒí˜• ì›”ë“œì»µ</title>
    <style>
        :root {
            /* ë¡œê³  ë¬´ë“œë¥¼ ë°˜ì˜í•œ ë”°ëœ»í•œ ë² ì´ì§€/ê³¨ë“œ */
            --primary-color: #A68B5E;
            /* ì€ì€í•œ ë°°ê²½ìƒ‰ */
            --background-color: #F8F8F8;
            /* ê¹¨ë—í•œ ë°°ê²½ìƒ‰ */
            --card-background: #FFFFFF;
            /* ì–‡ì€ ì„  ìƒ‰ìƒ */
            --border-color: #E0E0E0;
            /* í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
            --text-color: #333333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--background-color);
            min-height: 100vh;
            padding: 40px 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            width: 100%;
            padding: 20px;
            text-align: center;
        }

        /* --- ê³µí†µ ìŠ¤íƒ€ì¼: ë²„íŠ¼ ë° ì»¨í…Œì´ë„ˆ --- */
        .selection-group, .home-page, .worldcup-page, .result-page {
            background: var(--card-background);
            border-radius: 4px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            padding: 40px;
            margin-bottom: 30px;
        }

        h1 {
            color: var(--primary-color);
            font-weight: 300;
            margin-bottom: 10px;
            font-size: 32px;
        }
        h2 {
            color: var(--text-color);
            font-weight: 400;
            margin-bottom: 20px;
            font-size: 24px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }
        p {
            color: #666;
            margin-bottom: 20px;
        }

        .button-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }

        .btn, .start-btn, .next-btn, .restart-btn {
            padding: 12px 25px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.2s ease;
            background: var(--card-background);
            color: var(--text-color);
            text-decoration: none;
            display: inline-block;
        }

        /* ì„ íƒ ë²„íŠ¼ (ì„±ë³„/ì¹´í…Œê³ ë¦¬) */
        .btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        .btn:not(.active):hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        /* ë©”ì¸ ì•¡ì…˜ ë²„íŠ¼ */
        .start-btn, .next-btn, .restart-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            margin-top: 30px;
            padding: 15px 40px;
        }
        .start-btn:hover, .next-btn:hover, .restart-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(166, 139, 94, 0.4);
        }
        .start-btn:disabled, .next-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* --- Worldcup Page --- */
        .battle-container {
            display: grid;
            grid-template-columns: 1fr 1fr; /* A/B í…ŒìŠ¤íŠ¸ì²˜ëŸ¼ 1:1 ë¶„í•  */
            gap: 20px;
            margin-top: 40px;
        }

        .candidate-card {
            background: var(--card-background);
            border: 2px solid var(--border-color);
            border-radius: 4px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .candidate-card:hover {
            border-color: var(--primary-color);
            box-shadow: 0 5px 15px rgba(166, 139, 94, 0.2);
            transform: translateY(-2px);
        }

        /* ì„ íƒëœ ì¹´ë“œ ê°•ì¡° */
        .candidate-card.selected {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 5px rgba(166, 139, 94, 0.2);
            background: #FFFBF7; /* ì•„ì£¼ ë¯¸ë¬˜í•œ ë°°ê²½ìƒ‰ ë³€í™” */
        }

        .candidate-image {
            width: 100%;
            height: auto;
            max-height: 400px;
            object-fit: cover;
            border-radius: 2px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color); /* ì–‡ì€ ì„  ê°•ì¡° */
        }

        .candidate-name {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .candidate-info {
            font-size: 14px;
            color: #999;
        }

        .round-info {
            margin-bottom: 20px;
        }
        .round-info h2 {
            font-size: 36px;
            font-weight: 300;
            color: var(--text-color);
            border-bottom: none;
        }
        .round-info p {
            font-size: 18px;
            color: #666;
        }

        /* --- Result Page --- */
        .winner-card {
            display: inline-block;
            padding: 30px;
            background: var(--card-background);
            border: 3px solid var(--primary-color);
            border-radius: 4px;
            margin-top: 20px;
            box-shadow: 0 10px 30px rgba(166, 139, 94, 0.3);
            max-width: 400px;
        }
        .trophy {
            font-size: 50px;
            margin-bottom: 15px;
        }
        .winner-image {
            width: 100%;
            max-width: 300px;
            height: auto;
            border-radius: 4px;
            margin-bottom: 15px;
            border: 2px solid var(--primary-color);
        }
        .winner-name {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-color);
        }
        .winner-info {
            font-size: 16px;
            color: #666;
            margin-top: 5px;
        }

        /* --- ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ --- */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 50px;
        }
        .spinner {
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="home-page" id="homePage">
        <h1>ğŸ† gonglee's Ideal Type World Cup</h1>
        <p>ë¡œê³  ë¬´ë“œì²˜ëŸ¼ ê¹”ë”í•˜ê³  ë¯¸ë‹ˆë©€í•˜ê²Œ, ë‹¹ì‹ ì˜ ì´ìƒí˜•ì„ ì°¾ì•„ë³´ì„¸ìš”!</p>

        <div class="selection-group">
            <h2>ğŸ‘¤ ì„±ë³„ ì„ íƒ</h2>
            <div class="button-group">
                <button class="btn" data-gender="male">ğŸ‘¨ ë‚¨ì„±</button>
                <button class="btn" data-gender="female">ğŸ‘© ì—¬ì„±</button>
            </div>
        </div>

        <div class="selection-group">
            <h2>âœ¨ ì¹´í…Œê³ ë¦¬ ì„ íƒ</h2>
            <div class="button-group">
                <button class="btn" data-category="idol">â­ ì•„ì´ëŒ</button>
                <button class="btn" data-category="actor">ğŸ¬ ë°°ìš°</button>
            </div>
        </div>

        <button class="start-btn" id="startBtn" disabled>ì›”ë“œì»µ ì‹œì‘í•˜ê¸°</button>
    </div>
    <div class="worldcup-page" id="worldcupPage" style="display:none;">
        <div class="round-info">
            <h2 id="roundTitle">32ê°•</h2>
            <p id="roundDesc">ë‘ ëª… ì¤‘ ë” ì¢‹ì•„í•˜ëŠ” ì‚¬ëŒì„ ì„ íƒí•˜ì„¸ìš”</p>
        </div>

        <div class="loading" id="loading" style="display:none;">
            <div class="spinner"></div>
            <p>ë¡œë”© ì¤‘...</p>
        </div>

        <div class="battle-container" id="battleContainer">
            <div class="candidate-card" id="card1" data-index="0">
                <img class="candidate-image" id="image1" src="https://via.placeholder.com/500x750?text=Option+A" alt="í›„ë³´ ì´ë¯¸ì§€">
                <div class="candidate-name" id="name1">í›„ë³´ ì´ë¦„ A</div>
                <div class="candidate-info" id="info1">ì†Œì†/ì‘í’ˆëª… A</div>
            </div>

            <div class="candidate-card" id="card2" data-index="1">
                <img class="candidate-image" id="image2" src="https://via.placeholder.com/500x750?text=Option+B" alt="í›„ë³´ ì´ë¯¸ì§€">
                <div class="candidate-name" id="name2">í›„ë³´ ì´ë¦„ B</div>
                <div class="candidate-info" id="info2">ì†Œì†/ì‘í’ˆëª… B</div>
            </div>
        </div>

        <button class="next-btn" id="nextBtn" disabled>ë‹¤ìŒ ë¼ìš´ë“œ ì§„ì¶œ!</button>
    </div>
    <div class="result-page" id="resultPage" style="display:none;">
        <h1>ğŸ‰ ìµœì¢… ìš°ìŠ¹ì ê²°ì •!</h1>

        <div class="winner-card">
            <div class="trophy">ğŸ†</div>
            <img class="winner-image" id="winnerImage" src="https://via.placeholder.com/500x750?text=WINNER" alt="ìš°ìŠ¹ì ì´ë¯¸ì§€">
            <div class="winner-name" id="winnerName">ìµœì¢… ìš°ìŠ¹ì</div>
            <div class="winner-info" id="winnerInfo">ì†Œì†/ì‘í’ˆëª…</div>
        </div>

        <button class="restart-btn" id="restartBtn">ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
    </div>
</div>

<script>
    let selectedGender = null;
    let selectedCategory = null;

    let candidates = []; // APIì—ì„œ ë°›ì•„ì˜¨ ì „ì²´ í›„ë³´ ëª©ë¡
    let currentRoundCandidates = []; // í˜„ì¬ ë¼ìš´ë“œì— ë‚¨ì•„ìˆëŠ” í›„ë³´ë“¤ (32, 16, 8, ...)
    let nextRoundCandidates = []; // ë‹¤ìŒ ë¼ìš´ë“œ ì§„ì¶œì´ í™•ì •ëœ ìŠ¹ìë“¤
    let selectedCandidate = null; // í˜„ì¬ ëŒ€ê²°ì˜ ìŠ¹ì
    let matchIndex = 0; // í˜„ì¬ ë¼ìš´ë“œì—ì„œ ì§„í–‰í•  ëŒ€ê²°ì˜ ì‹œì‘ ì¸ë±ìŠ¤ (0, 2, 4, 6...)

    const API_BASE = 'http://localhost:8080/api/worldcup';

    // DOM ìš”ì†Œ ìºì‹±
    const homePage = document.getElementById('homePage');
    const worldcupPage = document.getElementById('worldcupPage');
    const resultPage = document.getElementById('resultPage');
    const loading = document.getElementById('loading');
    const genderBtns = document.querySelectorAll('[data-gender]');
    const categoryBtns = document.querySelectorAll('[data-category]');
    const startBtn = document.getElementById('startBtn');
    const nextBtn = document.getElementById('nextBtn');
    const card1 = document.getElementById('card1');
    const card2 = document.getElementById('card2');
    const restartBtn = document.getElementById('restartBtn');

    // ë°°ì—´ ì…”í”Œ í•¨ìˆ˜ (í”¼ì…”-ì˜ˆì´ì¸  ì•Œê³ ë¦¬ì¦˜)
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    // ì‹œì‘ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
    function updateStartBtn() {
        startBtn.disabled = !selectedGender || !selectedCategory;
    }

    // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ---

    genderBtns.forEach(btn => {
        btn.addEventListener('click', (e) => {
            genderBtns.forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            selectedGender = e.target.dataset.gender;
            updateStartBtn();
        });
    });

    categoryBtns.forEach(btn => {
        btn.addEventListener('click', (e) => {
            categoryBtns.forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            selectedCategory = e.target.dataset.category;
            updateStartBtn();
        });
    });

    startBtn.addEventListener('click', startTournament);
    nextBtn.addEventListener('click', processNextMatch);
    restartBtn.addEventListener('click', restartGame);

    // ì¹´ë“œ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ëŠ” ì•„ë˜ loadNextMatchup()ì—ì„œ ë™ì ìœ¼ë¡œ í• ë‹¹ë©ë‹ˆë‹¤.
    // card1.onclick = () => selectCandidate(currentRoundCandidates[matchIndex], 'card1');
    // card2.onclick = () => selectCandidate(currentRoundCandidates[matchIndex + 1], 'card2');


    // --- ì›”ë“œì»µ ì§„í–‰ ë¡œì§ ---

    async function startTournament() {
        try {
            showPage(worldcupPage); // ë¡œë”© ì‹œì—ë„ worldcupPage ì»¨í…Œì´ë„ˆë¥¼ ë³´ì—¬ì£¼ê¸° ìœ„í•¨
            showLoading(true);
            homePage.style.display = 'none';

            const response = await fetch(
                `${API_BASE}/start?tour=${selectedGender}&cat=${selectedCategory}`
            );
            candidates = await response.json();

            // í† ë„ˆë¨¼íŠ¸ ì´ˆê¸°í™”
            currentRoundCandidates = shuffleArray([...candidates]); // í›„ë³´ ì„ê¸°
            nextRoundCandidates = [];
            matchIndex = 0;

            loadNextMatchup();
        } catch (error) {
            console.error('Error:', error);
            alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„œë²„(http://localhost:8080)ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
            showPage(homePage);
        } finally {
            showLoading(false);
        }
    }

    function loadNextMatchup() {
        const totalCandidates = currentRoundCandidates.length;

        if (totalCandidates === 1) {
            // ìµœì¢… ìš°ìŠ¹ì ê²°ì •
            showWinner(currentRoundCandidates[0]);
            return;
        }

        if (matchIndex >= totalCandidates) {
            // í˜„ì¬ ë¼ìš´ë“œ ì¢…ë£Œ, ë‹¤ìŒ ë¼ìš´ë“œ ì‹œì‘
            currentRoundCandidates = nextRoundCandidates; // ìŠ¹ìë“¤ë§Œ ë‹¤ìŒ ë¼ìš´ë“œ í›„ë³´ë¡œ
            nextRoundCandidates = [];
            matchIndex = 0;
            return loadNextMatchup(); // ë‹¤ìŒ ë¼ìš´ë“œ ì¬ì§„í–‰
        }

        // í™”ë©´ ì •ë³´ ì—…ë°ì´íŠ¸
        const roundName = getRoundName(totalCandidates);
        document.getElementById('roundTitle').textContent = roundName;
        document.getElementById('roundDesc').textContent =
            `${roundName} (${matchIndex / 2 + 1} / ${totalCandidates / 2})ë²ˆì§¸ ëŒ€ê²°`;

        // ìˆœì„œëŒ€ë¡œ ë‘ í›„ë³´ë¥¼ ê°€ì ¸ì˜´
        const candidate1 = currentRoundCandidates[matchIndex];
        const candidate2 = currentRoundCandidates[matchIndex + 1];

        displayCandidate('1', candidate1);
        displayCandidate('2', candidate2);

        // UI ì´ˆê¸°í™”
        selectedCandidate = null;
        card1.classList.remove('selected');
        card2.classList.remove('selected');
        nextBtn.disabled = true;

        // ì¹´ë“œ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—…ë°ì´íŠ¸ (í´ë¡œì € ë¬¸ì œ ë°©ì§€)
        card1.onclick = () => selectCandidate(candidate1, 'card1');
        card2.onclick = () => selectCandidate(candidate2, 'card2');
    }

    function displayCandidate(num, candidate) {
        // ì„œë²„ì—ì„œ ì´ë¯¸ì§€ê°€ ì—†ì„ ê²½ìš° ëŒ€ì²´ ì´ë¯¸ì§€ ì‚¬ìš© (PlaceholderëŠ” ì´ë¯¸ì§€ ì£¼ì„ì²˜ë¦¬)
        const imageUrl = candidate.image_url || `https://via.placeholder.com/500x750?text=NO+IMAGE`;
        document.getElementById(`image${num}`).src = imageUrl;
        document.getElementById(`name${num}`).textContent = candidate.name;
        document.getElementById(`info${num}`).textContent = candidate.group_or_work || 'ì •ë³´ ì—†ìŒ';
    }

    function selectCandidate(candidate, cardId) {
        selectedCandidate = candidate;

        card1.classList.remove('selected');
        card2.classList.remove('selected');
        document.getElementById(cardId).classList.add('selected');

        nextBtn.disabled = false;
    }

    function processNextMatch() {
        if (selectedCandidate) {
            // ì„ íƒëœ í›„ë³´ë¥¼ ë‹¤ìŒ ë¼ìš´ë“œ ë°°ì—´ì— ì¶”ê°€ (ìŠ¹ì í™•ì •)
            nextRoundCandidates.push(selectedCandidate);

            // ë‹¤ìŒ ëŒ€ê²°ë¡œ ì¸ë±ìŠ¤ ì´ë™ (2ê°œì”© ê±´ë„ˆë›°ê¸°)
            matchIndex += 2;

            loadNextMatchup();
        }
    }

    function getRoundName(count) {
        const roundMap = {
            32: '32ê°•',
            16: '16ê°•',
            8: '8ê°•',
            4: '4ê°•',
            2: 'ê²°ìŠ¹',
            1: 'ìš°ìŠ¹ì'
        };
        return roundMap[count] || `${count}ê°•`;
    }

    function showWinner(winner) {
        showPage(resultPage);

        const winnerImage = document.getElementById('winnerImage');
        const imageUrl = winner.image_url || `https://via.placeholder.com/500x750?text=WINNER`;
        winnerImage.src = imageUrl;
        document.getElementById('winnerName').textContent = winner.name;
        document.getElementById('winnerInfo').textContent = winner.group_or_work || 'ì •ë³´ ì—†ìŒ';
    }

    function showPage(pageElement) {
        homePage.style.display = 'none';
        worldcupPage.style.display = 'none';
        resultPage.style.display = 'none';

        if (pageElement === worldcupPage) {
            worldcupPage.style.display = 'block';
        } else if (pageElement === homePage) {
            homePage.style.display = 'block';
        } else if (pageElement === resultPage) {
            resultPage.style.display = 'block';
        }
    }

    function restartGame() {
        selectedGender = null;
        selectedCategory = null;
        nextRoundCandidates = [];
        currentRoundCandidates = [];
        selectedCandidate = null;
        matchIndex = 0;

        genderBtns.forEach(b => b.classList.remove('active'));
        categoryBtns.forEach(b => b.classList.remove('active'));

        showPage(homePage);
        updateStartBtn();
    }

    function showLoading(show) {
        loading.style.display = show ? 'flex' : 'none'; /* ë¡œë”©ì€ flexë¡œ ì¤‘ì•™ ì •ë ¬ */
        // ë¡œë”© ì¤‘ì¼ ë•ŒëŠ” ë°°í‹€ ì»¨í…Œì´ë„ˆì™€ ë‹¤ìŒ ë²„íŠ¼ì„ ìˆ¨ê¹€
        document.getElementById('battleContainer').style.display = show ? 'none' : 'grid';
        document.getElementById('nextBtn').style.display = show ? 'none' : 'block';
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ìƒíƒœ ì„¤ì •
    document.addEventListener('DOMContentLoaded', () => {
        updateStartBtn();
        showPage(homePage);
    });
</script>
</body>
</html>